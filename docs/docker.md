Docker –∫–∞–∫ —è –ø–æ–Ω—è–ª —ç—Ç–æ:

1. –ö–∞–∫ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞, –≤–µ–¥—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ –Ω—É–∂–Ω–∞ –¥–ª—è —Ç–æ–≥–æ —á—Ç–æ –±—ã –∫–æ–º–ø–∏–ª–∏—Ä—É–µ–º—ã–π –∫–æ–¥ –º–æ–≥ –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ—Ö —Å–∏—Å—Ç–µ–º–∞—Ö, –∞ —Ç—É—Ç –µ—Å—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ–∑–∞—Ç–æ—Ä –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏ —á—Ç–æ —Ç–∞–º –µ—Å—Ç—å Docker Engine
2. –ù–æ –ø—Ä–∏ —Ç–æ–º –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–ª–Ω–æ–π —É—Å—Ç–æ–Ω–æ–≤–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –¥–ª—è —Å–µ–±—è
3. –ö–∞–∫ —Å–ª–µ–¥—Å—Ç–≤–µ–µ –ø—Ä–æ–∏–∑–∑–≤–æ—Ç–µ–ª—å–Ω–µ–µ –∏ –º–µ–Ω–µ–µ –∑–∞—Ç—Ä–∞—Ç–æ–µ
4. –°–æ—Å–æ—Ç–æ–∏—Ç –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤: –∫–∞–∂–¥—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–º–µ–µ—Ç –≤—Å—é —ç–∫–æ—Å–∏—Å—Ç–µ–º—É –¥–ª—è —Å–æ—Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è
5. –ï—Å–ª–∏ –≤ –¥–≤—É—Ö —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –µ—Å—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ä—Å–∏—è—Ö, —ç—Ç–æ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É
6. –ü–æ–ª–µ–¥–Ω—è—è –í–µ—Ä—Å–∏—è 28.2.2, –æ–¥–Ω–∫–æ chatGPT —É–∑–Ω–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ—Ç –ª—é–¥–µ–π –∞ –∑–Ω–∞—á–∏—Ç –µ—Å–ª–∏ –Ω–∏–∫—Ç–æ –µ–º—É –Ω–µ —Ä–∞–∑–∫–∞–∂–µ—Ç —á—Ç–æ –æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –µ—Å—Ç—å –≤–µ—Ä—Å–∏—è 28.2.2, —Ç–æ –æ–Ω –¥–æ —Ç–æ–≥–æ –Ω–µ –±—É–¥–µ—Ç –∑–Ω–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
7. docker - –ø—Ä–æ—ç–∫—Ç –∞—Ä—Ö–µ—Ç–µ–∫—Ç—É—Ä—ã, –∏ –Ω—É–∂–¥–∞–µ—Ç—Å—è –≤ —á–µ—Ä—Ç–µ–∂–µ(—Å–º –û–±—Ä–∞–∑)

Docker Engine - –ö–ª–∏–µ–Ω—Ç-–°–µ—Ä–≤–µ—Ä–Ω–æ–µ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, —Å–æ—Å—Ç–æ—è—â–∏–π –∏–∑

–°–µ—Ä–≤–µ—Ä–∞ "Docker –î–µ–º–æ–Ω" - —Ñ–æ–Ω–æ–≤–æ–π –ø—Ä–æ—Å–µ—Å—Å, –∫–æ—Ç–æ—Ä–π –≤—Å–µ–º —Ä—É–ª–∏—Ç. –æ–Ω —Ç–æ –∏ —Å–æ–∑–¥–∞–µ—Ç –∏ —É–ø—Ä–æ–≤–ª—è–µ—Ç –æ–±—Ä–∞–∑—ã, –∫–æ–Ω—Ç–µ–π—Ç–µ—Ä—ã, —Ç–æ–º–∞
API - –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–±–µ—Å–ø–µ–∏–≤–∞—é—â–∏–π –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –î–µ–º–æ–Ω–∞ —Å CLI –∫–ª–∏–µ–Ω—Ç–æ–º
CLI –∫–ª–∏–µ–Ω—Ç - –ø–æ —Å—É—Ç–∏ –∫–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞

Dockerfile - —Ñ–∞–π–ª —Å –∏–Ω—Å—Ç—Ä—É–∫–∏—è–º–∏ –∫–∞–∫ —Å–æ–∑–∞–¥–∞—Ç—å –û–±—Ä–∞–∑
Dockerimage(–û–±—Ä–∞–∑) - –®–∞–±–ª–æ–Ω –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –∫–æ—Ç–æ—Ä–æ–≥–∞ —Å–æ–∑–¥–∞—é—Ç—Å—è –∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
Dockercontainer - –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–µ–¥—Å—Ç–æ–≤–ª—è—é—Ç –∏–∑ —Å–µ–±—è –Ω–∞–±–æ—Ä —Ñ–∞–π–ª–æ–≤, –¥–µ—Ä–µ–∫—Ç–æ—Ä–∏–π, —Å–∏–º–≤–æ–ª–∏–µ—Å–∫–∏–π —Å—Å—ã–ª–æ–∫ –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

–∏–Ω—ã–º–∏ —Å–ª–æ–≤–∞–º–∏ —á–µ—Ä—Ç–µ–∂ –¥–ª—è —Ñ–æ—Ä–º—ã –¥–ª—è –ø–µ—á–µ–Ω—å—è —ç—Ç–æ Dockerfile, —Å–∞–º–∞ —Ñ–æ—Ä–º–∞ –¥–ª—è –∑–∞–ø–µ–∫–∞–Ω–∏—è —ç—Ç–æ –∫–∞–∫ Dockerimage, –∞ –ü–µ–µ–Ω—å–µ —ç—Ç–æ Docker container

–û—Ç–∫—Å–ª–∫–∏:
–í–µ–ª–∏–∫–∏–π –æ–±—Ä–∞–∑ –ê–º–±–µ—Ä–∞ –∏–∑ –•—Ä–æ–Ω–∏–∫ –ê–º–±–µ—Ä–∞ –∫–∞–∫ "–û–±—Ä–∞–∑" –Ω—É –∏ –î–µ–π–º–æ–Ω –¢–∞—Ä–≥–∞—Ä–∏–µ–Ω –∫–∞–∫ "–î–µ–º–æ–Ω"

–ü—Ä–∞–∫—Ç–∏–∫–∞:

üêß –£—Å—Ç–æ–Ω–æ–≤–∏–º –Ω–∞ Ubuntu Docker:

```bash
# 1. –û–±–Ω–æ–≤–∏ –∏–Ω–¥–µ–∫—Å –ø–∞–∫–µ—Ç–æ–≤
sudo apt update

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
sudo apt install apt-transport-https ca-certificates curl software-properties-common

# 3. –î–æ–±–∞–≤—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π GPG –∫–ª—é—á Docker
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/trusted.gpg.d/docker.gpg

# 4. –î–æ–±–∞–≤—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π Docker
sudo add-apt-repository "deb [arch=$(dpkg --print-architecture)] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"

# 5. –ï—â—ë —Ä–∞–∑ –æ–±–Ω–æ–≤–∏ –∏–Ω–¥–µ–∫—Å –ø–∞–∫–µ—Ç–æ–≤
sudo apt update

# 6. –£—Å—Ç–∞–Ω–æ–≤–∏ Docker Engine
sudo apt install docker-ce docker-ce-cli containerd.io

# 7. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ Docker —Ä–∞–±–æ—Ç–∞–µ—Ç
sudo docker run hello-world

sudo usermod -aG docker $USER

docker --version
```

Dockerfile: –Ω–∞–¥–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–ª—è —Å–æ–∑–∞–¥–∞–Ω–∏—è –û–±—Ä–æ–∑–∞:

```Dockerfile
FROM alpine
CMD ["echo", "Hello from Alpine!"]
```

—Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—Ä–∞–∑ –∞ –ø–æ—Ç–æ–º –¥–µ–ª–∞–µ–º container

```bash
sudo docker build -t testimage .
sudo docker run testimage
```

–§–∞–∫—Ç!
Docker Hub - –û–±—â–µ–¥–æ—Å—Ç—É–ø–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –æ–±—Ä–∞–∑–æ–≤ ‚Äî –∫–∞–∫ GitHub –¥–ª—è –∫–æ–¥–∞.

–≤—ã–≤–æ–¥ –≤—Å–µ—Ö –æ–±—Ä–∞–∑–æ–≤ - docker image ls
docker push - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–±—Ä–∞–∑ –≤ docker hub
docker pull - —Å–∫–∞—á–∞—Ç—å –æ–±—Ä–∞–∑

–≤–æ–æ–±—â–µ–º, —Å –Ω—É–ª—è –¥–µ–ª–∞–µ–º –≤—Å–µ:

–ö–æ–º–∞–Ω–¥—ã:

```bash
mkdir docker
touch Dockerfile
```

Dockerfile:

```Dockerfile
FROM alpine
CMD ["echo", "Hello from Alpine!"]
```

–ö–æ–º–∞–Ω–¥—ã:

```bash
docker build -t testimage .
docker run testimage
```

—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º—Å—è –Ω–∞ docker hub

–ö–æ–º–∞–Ω–¥—ã:

```bash
sudo docker login
sudo docker tag testimage azamatnigmatullin/testimage:latest
sudo docker push azamatnigmatullin/testimage:latest
```

–∫–æ–ø–∏—Ä—É–µ–º –æ—Ç—Ç—É–¥–∞:

```bash
sudo docker pull azamatnigmatullin/testimage
```

–ø—Ä–æ–≤–µ—Ä–∫–∞:

```bash
sudo docker image list
```

—Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ—ç–∫—Ç:

sudo docker tag testimage azamatnigmatullin/testimage:latest
sudo docker push azamatnigmatullin/testimage:latest

–∑–∞–ª–∏—Ç—å –ø—Ä–æ—ç–∫—Ç:

sudo docker build -t rails .
sudo docker run -p 3000:3000 rails
sudo docker tag rails azamatnigmatullin/rails:latest
sudo docker push azamatnigmatullin/rails:latest

sudo docker build -t rails .
sudo docker tag rails azamatnigmatullin/rails:latest
sudo docker push azamatnigmatullin/rails:latest
sudo docker pull azamatnigmatullin/rails:latest

## Melisearch

Gemfile:

```ruby
gem 'meilisearch-rails'
```

<!-- –∏ –∑–∞–º–µ–Ω–∏—Ç—å –≥–µ–º `gem "sqlite3", ">= 1.4"` –Ω–∞ `gem 'pg', '~> 1.5'` -->

<!-- –£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤ config/database.yml —É–∫–∞–∑–∞–Ω adapter: postgresql -->

–ö–æ–º–∞–Ω–¥—ã:

```bash
bundle install
docker run --rm -p 7700:7700 -e MEILI_MASTER_KEY=SUPERSECRET getmeili/meilisearch:v1.7
```

–§–∞–∫—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é Melisearch –∏–¥–µ—Ç –Ω–∞ `http://127.0.0.1:7700`

SearchController:

```ruby
class SearchController < ApplicationController
  def index
    if params[:q].present?
      @wars = War.search(params[:q])
      @countries = Country.search(params[:q])
      @figures = Figure.search(params[:q])
      @battles = Battle.search(params[:q])
      @users = User.search(params[:q])
      @events = Event.search(params[:q])
    else
      @wars = []
      @countries = []
      @figures = []
      @events = []
      @battles = []
      @users = []
    end
  end
end
```

config/routes.rb:

```ruby
get 'search', to: 'search#index'
```

navbar:

```ruby
<form action="/search" method="get">
  <input name="q" type="text" placeholder="Search...">
  <button type="submit"><i class='bx bx-search'></i></button>
</form>
```

Model:

```ruby
meilisearch do
  attributes :name, :number, :first_belligerents, :second_belligerents, :date # –∫–∞–∫–∏–µ —Ç–æ –ø–∞—Ä–º–µ—Ç—Ä—ã
end
```

touch config/initializers/meilisearch.rb:

```ruby
MeiliSearch::Rails.configuration = {
  meilisearch_url: ENV.fetch('MEILISEARCH_URL', 'http://127.0.0.1:7700'),
  meilisearch_api_key: ENV.fetch('MEILISEARCH_API_KEY', 'SUPERSECRET')
}
```

mkdir -p app/views/search
touch app/views/search/index.html.erb:

```erb
<h1>Search results for: <%= params[:q] %></h1>

<h2>Wars</h2>
<ul>
  <% @wars.each do |war| %>
    <li><%= link_to war.name, war_path(war) %></li>
  <% end %>
</ul>

<h2>Countries</h2>
<ul>
  <% @countries.each do |country| %>
    <li><%= link_to country.name, country_path(country) %></li>
  <% end %>
</ul>

<h2>Figures</h2>
<ul>
  <% @figures.each do |figure| %>
    <li><%= link_to figure.name, figure_path(figure) %></li>
  <% end %>
</ul>

<h2>Battles</h2>
<ul>
  <% @battles.each do |battle| %>
    <li><%= link_to battle.name, battle_path(battle) %></li>
  <% end %>
</ul>

<h2>Events</h2>
<ul>
  <% @events.each do |event| %>
    <li><%= link_to event.name, event_path(event) %></li>
  <% end %>
</ul>

<h2>Users</h2>
<ul>
  <% @users.each do |user| %>
    <li><%= link_to user.email, user_path(user) %></li>
  <% end %>
</ul>
```

touch docker-compose.yml:

```yml
version: "3.8"

services:
  web:
    build: .
    command: bundle exec rails s -b 0.0.0.0 -p 3000
    ports:
      - "3000:3000"
    depends_on:
      - meilisearch
    environment:
      RAILS_ENV: development
      MEILISEARCH_URL: "http://meilisearch:7700"
      MEILISEARCH_API_KEY: "SUPERSECRET"
    volumes:
      - .:/app:delegated
      - ./db:/app/db # <-- –º–æ–Ω—Ç–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é –ø–∞–ø–∫—É db –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
      - bundle_cache:/usr/local/bundle
      - db_data:/app/db # ‚úÖ –ë–ê–ó–ê –í–°–ï–ì–î–ê –í db/ !!!
      - /app/tmp
      - /app/node_modules

  meilisearch:
    image: getmeili/meilisearch:v1.7
    ports:
      - "7700:7700"
    environment:
      MEILI_MASTER_KEY: "SUPERSECRET"

volumes:
  bundle_cache:
  db_data: # ‚úÖ –¢–æ–º —Ç–µ–ø–µ—Ä—å –ø–æ–¥ db/
```

config/database.yml:

```yml
default: &default
  adapter: sqlite3
  pool: <%= ENV.fetch("RAILS_MAX_THREADS") { 5 } %>
  timeout: 5000

development:
  <<: *default
  database: db/development.sqlite3

test:
  <<: *default
  database: db/test.sqlite3

production:
  <<: *default
  database: db/production.sqlite3
```

sudo docker compose down -v
sudo docker compose up --build

–≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

`sudo docker compose down --volumes`
`sudo docker compose up --build`
–∏ —É –Ω–∞—Å –ø–æ—è–≤–∏—Ç—Å—è 3000 –ª–æ–∫–∞–ª—Ö–æ—Å—Ç –∏ 7700 –¥–ª—è melisearch.

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–º–µ–Ω—è–ª –≤ Dockerfile –∏–ª–∏ –≤ –≥–µ–º–∞—Ö:

sudo docker-compose build
sudo docker compose up

sudo docker compose up --build
